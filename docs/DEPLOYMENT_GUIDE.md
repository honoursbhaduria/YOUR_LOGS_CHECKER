# Deployment Guide: Render (Backend) + Vercel (Frontend)

## Prerequisites
- GitHub account with repository pushed
- Render account (https://render.com)
- Vercel account (https://vercel.com)
- API keys: OpenAI/Anthropic/Google (for LLM features)

---

## üîß Backend Deployment on Render

### 1. Database Setup (PostgreSQL)
1. Go to Render Dashboard ‚Üí **New** ‚Üí **PostgreSQL**
2. Name: `forensic-logs-db`
3. Database: `forensic_db`
4. User: `forensic_user`
5. Region: Choose closest to you
6. Plan: **Free** (or Starter for production)
7. Click **Create Database**
8. **Copy the Internal Database URL** (starts with `postgresql://`)

### 2. Redis Setup
1. Go to Render Dashboard ‚Üí **New** ‚Üí **Redis**
2. Name: `forensic-logs-redis`
3. Plan: **Free** (or Starter)
4. Click **Create Redis**
5. **Copy the Redis URL** (starts with `redis://`)

### 3. Backend Web Service
1. Go to Render Dashboard ‚Üí **New** ‚Üí **Web Service**
2. Connect your GitHub repository
3. Configure:

   **Basic Settings:**
   - Name: `your-logs-checker` (or your preferred name)
   - Region: Same as database
   - Branch: `main`
   - Root Directory: `backend`
   - Environment: **Docker**
   - Dockerfile Path: `./Dockerfile`

   **Environment Variables:** (Add these in Render dashboard)
   ```bash
   DJANGO_SECRET_KEY=<auto-generated by Render>
   DEBUG=False
   ALLOWED_HOSTS=your-logs-checker.onrender.com,<your-actual-render-url>
   
   # Database (paste your Internal Database URL from step 1)
   DATABASE_URL=postgresql://forensic_user:****@****:5432/forensic_db
   
   # Redis (paste your Redis URL from step 2)
   CELERY_BROKER_URL=redis://****:6379/0
   CELERY_RESULT_BACKEND=redis://****:6379/0
   
   # CORS - Update with your Vercel URL after frontend deployment
   CORS_ALLOWED_ORIGINS=https://your-app.vercel.app
   
   # LLM API Keys (get from respective providers)
   OPENAI_API_KEY=sk-**** (optional)
   ANTHROPIC_API_KEY=sk-ant-**** (optional)
   GOOGLE_API_KEY=AIza**** (recommended - has free tier)
   DEFAULT_LLM_PROVIDER=google
   DEFAULT_LLM_MODEL=gemini-2.0-flash-exp
   
   # Google OAuth (if using Google login)
   GOOGLE_OAUTH_CLIENT_ID=****
   GOOGLE_OAUTH_CLIENT_SECRET=****
   ```

4. Click **Create Web Service**
5. Wait for deployment (5-10 minutes first time)
6. **Copy your backend URL**: `https://your-logs-checker.onrender.com`

### 4. Celery Worker (Background Tasks)
1. Go to Render Dashboard ‚Üí **New** ‚Üí **Background Worker**
2. Connect same repository
3. Configure:
   - Name: `forensic-celery-worker`
   - Root Directory: `backend`
   - Environment: **Docker**
   - Docker Command: `celery -A config worker -l info`
   - Same environment variables as backend (DATABASE_URL, CELERY_BROKER_URL, etc.)
4. Click **Create Background Worker**

---

## üöÄ Frontend Deployment on Vercel

### 1. Deploy to Vercel
1. Go to Vercel Dashboard ‚Üí **Add New** ‚Üí **Project**
2. Import your GitHub repository
3. Configure:

   **Build Settings:**
   - Framework Preset: **Create React App**
   - Root Directory: `frontend`
   - Build Command: `npm run build`
   - Output Directory: `build`
   - Install Command: `npm install`

   **Environment Variables:**
   ```bash
   # Replace with your actual Render backend URL
   REACT_APP_API_URL=https://your-logs-checker.onrender.com/api
   ```

4. Click **Deploy**
5. Wait for deployment (2-5 minutes)
6. **Copy your frontend URL**: `https://your-app.vercel.app`

### 2. Update Backend CORS
1. Go back to Render dashboard
2. Open your backend web service
3. Update `CORS_ALLOWED_ORIGINS` environment variable:
   ```
   https://your-app.vercel.app
   ```
4. Save ‚Üí Service will redeploy automatically

---

## ‚úÖ Post-Deployment Checklist

### Backend Health Check
Visit: `https://your-logs-checker.onrender.com/api/health/`
Should return: `{"status": "healthy"}`

### Frontend Test
1. Visit your Vercel URL: `https://your-app.vercel.app`
2. Try to register/login
3. Upload a test log file
4. Generate a report

### Common Issues

**‚ùå CORS Error (Frontend can't connect to backend)**
- Solution: Check `CORS_ALLOWED_ORIGINS` includes your Vercel URL (no trailing slash)
- Make sure Vercel URL matches exactly

**‚ùå 500 Error on Backend**
- Check Render logs: Dashboard ‚Üí Service ‚Üí Logs
- Verify all environment variables are set
- Check DATABASE_URL is correct

**‚ùå Login/Register not working**
- Verify `DJANGO_SECRET_KEY` is set
- Check database migrations ran successfully
- Look for errors in Render logs

**‚ùå PDF/LaTeX not working**
- LaTeX is installed in Dockerfile
- Check backend logs for pdflatex errors
- May need to increase Render plan for memory

**‚ùå Background tasks not processing**
- Check Celery worker logs in Render
- Verify Redis URL is correct
- Make sure CELERY_BROKER_URL matches

---

## üîÑ Updating Your Deployment

### Automatic Deployment (Recommended)
- Push to GitHub `main` branch
- Render and Vercel auto-deploy

### Manual Deployment
**Render:**
- Dashboard ‚Üí Service ‚Üí Manual Deploy ‚Üí Deploy latest commit

**Vercel:**
- Dashboard ‚Üí Project ‚Üí Deployments ‚Üí Redeploy

---

## üí∞ Free Tier Limits

### Render Free Tier:
- ‚úÖ PostgreSQL: 1 GB storage
- ‚úÖ Redis: 25 MB storage
- ‚úÖ Web Service: Sleeps after 15 min inactivity (wakes on request)
- ‚ö†Ô∏è First request after sleep: 30-60 seconds
- üí° Upgrade to Starter ($7/mo) to keep always-on

### Vercel Free Tier:
- ‚úÖ Unlimited bandwidth
- ‚úÖ Automatic HTTPS
- ‚úÖ 100 deployments/day
- ‚úÖ Perfect for frontend

---

## üîí Security Notes

1. **Never commit secrets to Git**
   - Use environment variables for all API keys
   - Keep `.env` in `.gitignore`

2. **HTTPS Only in Production**
   - Render and Vercel provide free HTTPS
   - Set `DEBUG=False` in production

3. **Strong Secret Key**
   - Let Render generate `DJANGO_SECRET_KEY`
   - Never reuse development keys

4. **Database Backups**
   - Render free tier: Manual backups only
   - Paid plans: Automatic daily backups

---

## üìä Monitoring

### Render Dashboard
- View logs: Service ‚Üí Logs
- Monitor CPU/Memory: Service ‚Üí Metrics
- Database usage: PostgreSQL ‚Üí Metrics

### Application Logs
- Backend errors: Render logs
- Frontend errors: Browser console + Vercel logs

---

## üÜò Support Resources

- **Render Docs**: https://render.com/docs
- **Vercel Docs**: https://vercel.com/docs
- **Django Deployment**: https://docs.djangoproject.com/en/stable/howto/deployment/
- **Your Backend URL**: `https://your-logs-checker.onrender.com`
- **Your Frontend URL**: `https://your-app.vercel.app`

---

## üéâ You're Done!

Your AI-Assisted Digital Forensics Platform is now live on:
- **Backend**: Render (PostgreSQL + Redis + Celery)
- **Frontend**: Vercel (React/TypeScript)

Share your URL with users and start analyzing logs! üöÄ
